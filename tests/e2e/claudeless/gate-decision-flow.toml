# gate-decision-flow.toml
#
# Claudeless scenario: Decision gate enforcement — full session lifecycle
#
# This scenario simulates a Claude Code session where:
#   1. Agent starts without a decision → Stop hook blocks
#   2. Agent creates a decision (gb decision create)
#   3. Human responds to the decision
#   4. Agent can now exit cleanly (Stop hook allows)
#
# The hook calls (gb bus emit --hook=Stop) are configured in
# .claude/settings.json hooks. The gb binary must be in PATH and
# KD_AGENT_ID must be set to a claimed bead ID.
#
# Run via: tests/e2e/scripts/test-gate-system.sh

[claude]
session_id = "e2e00000-0001-0001-0001-000000000001"
username = "e2e-test"
permission_mode = "accept-edits"
trusted = true
logged_in = true

[claude.timeouts]
hook_timeout_ms = 10000

# ── First user prompt: Ask agent to create a decision ─────────────
[[responses]]
on = { contains = "create a decision" }
say = "I'll create a decision point now."
[[responses.tools]]
call = "Bash"
[responses.tools.input]
command = "gb decision create --prompt='What next?' --options='[{\"id\":\"a\",\"label\":\"Continue\"}]' --no-wait"
[responses.tools.result]
stdout = "Decision created: kd-decision-001"
stderr = ""
exit_code = 0

# ── Second prompt: Agent reports decision created ──────────────────
[[responses]]
on = "*"
say = "Decision point created. The gate should now be satisfiable once you respond."

# ── Fallback ──────────────────────────────────────────────────────
[default]
say = "I'm an E2E test agent. I'll respond to your prompts."

# ── Tool config ───────────────────────────────────────────────────
[tools]
mode = "live"

[tools.Bash]
approve = true
