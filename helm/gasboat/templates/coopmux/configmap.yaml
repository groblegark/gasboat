{{- if .Values.coopmux.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "gasboat.coopmux.fullname" . }}-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "gasboat.coopmux.labels" . | nindent 4 }}
data:
  config.json: |
    {
      "accounts": [
        {
          "name": {{ .Values.coopmux.credentials.accountName | quote }},
          "provider": {{ .Values.coopmux.credentials.provider | quote }},
          "token_url": {{ .Values.coopmux.credentials.tokenUrl | quote }},
          "client_id": {{ .Values.coopmux.credentials.clientId | quote }},
          "device_auth_url": {{ .Values.coopmux.credentials.deviceAuthUrl | quote }},
          "auth_url": {{ .Values.coopmux.credentials.authorizeUrl | default "https://claude.ai/oauth/authorize" | quote }},
          "reauth": {{ if kindIs "bool" .Values.coopmux.credentials.reauth }}{{ .Values.coopmux.credentials.reauth }}{{ else }}true{{ end }}
        }
        {{- range .Values.coopmux.extraAccounts }}
        ,{
          "name": {{ .name | quote }},
          "provider": {{ .provider | default "claude" | quote }},
          "token_url": {{ .tokenUrl | default "https://platform.claude.com/v1/oauth/token" | quote }},
          "client_id": {{ .clientId | default "9d1c250a-e61b-44d9-88ed-5944d1962f5e" | quote }},
          "device_auth_url": {{ .deviceAuthUrl | default "https://console.anthropic.com/v1/oauth/device/code" | quote }},
          "auth_url": {{ .authorizeUrl | default "https://claude.ai/oauth/authorize" | quote }},
          "reauth": {{ if kindIs "bool" .reauth }}{{ .reauth }}{{ else }}true{{ end }}
        }
        {{- end }}
      ]
    }
{{- end }}
